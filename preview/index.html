<html>
<head>
<script src="jquery-2.0.2.min.js"></script>
<style>

#bones ul {
  list-style-type: none;
  margin: 0;
  padding-left: 1em;
}

#bones li a {
  text-decoration: none;
}

body {
  font-family: Arial, Verdana, sans-serif;
  font-size: 14px;
  background: #202020;
}

body, a {
  color: #f0f0f0;
}


#bones {
  float: left;
  margin-right: 24px;
}

#image {
  margin-left: auto;
  margin-right: auto;
  width: 410px;
  position: relative;
}

#image img.main {
  width: 400px;
}

#control {
  clear: both;
  padding-top: 50px;
  padding-left: 20px;
}

</style>
</head>

<div id="bones">
</div>
<div id="image">
</div>

<div id="controls">
</div>

<script>
//TODO ponerlo en $(window).onload


var Huesitos = {};

Huesitos.data = {"bones":[{"name":"Cintura Pélvica","images":[{"imagePath":"0.jpg","name":"Cara lateral","points":[{"name":"Pubis","y":1010,"x":1400},{"name":"Acetabulo","y":990,"x":1065},{"name":"Foramen obturador","y":835,"x":1155},{"name":"Ileon","y":2100,"x":640},{"name":"Isquion","y":335,"x":745}]},{"imagePath":"1.jpg","name":"Cara Dorsal","points":[{"name":"Pubis","y":900,"x":1005},{"name":"Acetabulo","y":920,"x":1605},{"name":"Foramen obturador","y":680,"x":1390},{"name":"Isquion","y":190,"x":1505},{"name":"Ileon","y":2235,"x":1525}]},{"imagePath":"3.jpg","name":"cintura pelvica1.jpg","points":[{"name":"Acetabulo","y":1200,"x":919},{"name":"Pubis","y":1260,"x":713},{"name":"Isquion","y":513,"x":1306},{"name":"Foramen obturador","y":823,"x":926},{"name":"Ileon","y":2316,"x":1256}]},{"imagePath":"4.jpg","name":"cintura.jpg","points":[{"name":"Isquion","y":325,"x":315},{"name":"Foramen obturador","y":765,"x":815},{"name":"Acetabulo","y":1050,"x":540},{"name":"Pubis","y":940,"x":1055},{"name":"Ileon","y":443,"x":321}]}]}],"lastImageId":5};

Huesitos.showingRefs = false;
Huesitos.currentBone = null;

Huesitos.showReferences = function() {
  if (Huesitos.showingRefs)
    return;
  Huesitos.showingRefs = true;

  var container = Huesitos.getImageContainer();
  var img = container.find('img.main')[0];
  var w = img.width;
  var h = img.height;
  var nw = img.naturalWidth;
  var nh = img.naturalHeight;


  var points = Huesitos.currentImage.points;
  points.forEach(function(point) {
    var dot = $('<img src="dot.png">').addClass('reference');
    var x = w * point.x / nw;
    var y = h * point.y / nh;
    dot.css('left', x).css('top', y).css('position', 'absolute');
    container.append(dot);
  });
};

Huesitos.removeReferences = function() {
  Huesitos.getImageContainer().find('img.reference').remove();
  Huesitos.showingRefs = false;
};

Huesitos.updateReferencesButton = function() {
  var btnShowRefs = $(Huesitos.getControlsContainer().find('.updateRefs')[0]);
  if (Huesitos.showingRefs)
    btnShowRefs.empty().append('Ocultar referencias');
  else
    btnShowRefs.empty().append('Ver referencias');
};

Huesitos.toggleReferences = function() {
  if (Huesitos.showingRefs)
    Huesitos.removeReferences();
  else
    Huesitos.showReferences();

  Huesitos.updateReferencesButton();
};

Huesitos.getControlsContainer = function() {
  return $('#controls');
};

Huesitos.showControls = function() {
  var refs = $('<a href="#">').addClass('updateRefs').click(function() {
    Huesitos.toggleReferences();
    return false;
  });
  Huesitos.getControlsContainer().empty().append(refs);
  Huesitos.updateReferencesButton();
};

Huesitos.getImageContainer = function() {
  return $('#image');
};

Huesitos.showImage = function(node) {
  Huesitos.currentImage = $(node).data('image-data');

  var img = new Image();
  $(img).addClass('main');
  Huesitos.getImageContainer().empty().append(img);
  img.onload = function() {
    Huesitos.showControls();
  }
  img.src = Huesitos.currentImage.imagePath;
};

Huesitos.listImages = function(bone) {
  var images = bone['images'];
  var node = $("<ul class='images'>");
  images.forEach(function(image) {
    var linkNode = $("<a href='#'>").append(image.name).data('image-data', image)
    .click(function() {
      Huesitos.showImage(this);
      return false;
    });
    node.append($("<li>").append(linkNode));
  });

  return node;
};

Huesitos.listBones = function() {
  var div = $('#bones');
  div.empty();

  var bones = Huesitos.data['bones'];
  var node = $("<ul class='bones'>")
  bones.forEach(function(bone) {
    node.append($("<li>").append(bone.name).append(Huesitos.listImages(bone)));
  });

  div.append(node);
};


$(document).ready(function() {
  Huesitos.listBones();
});
</script>
<body>
</body>

